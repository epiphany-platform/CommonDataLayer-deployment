name: test baremetal deployment

on:
  push:
    branches:
      - "develop"
  pull_request:


jobs:
  component-testing:
    name: Test modules
    runs-on: ubuntu-latest

    steps:
      - name: Checkout source code
        uses: actions/checkout@v2
        with:
          clean: true
          submodules: true

      - name: Start environment via docker-compose
        run: docker-compose -f compose/docker-compose.yml up -d postgres kafka

      - name: Install Rust
        uses: actions-rs/toolchain@v1
        with:
          toolchain: nightly
          profile: minimal
          override: true
          components: clippy, rustfmt

      - name: Build cdl
        run: |
          cd cdl
          cargo build